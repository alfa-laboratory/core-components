import { useState } from 'react';
import { Meta, Story, Props, Preview, Title } from '@storybook/addon-docs/blocks';
import { text, select, number, boolean } from '@storybook/addon-knobs';
import { Design } from 'storybook/blocks/design';

import { Confirmation } from './component';
import { name, version } from '../package.json';

<Meta title='Компоненты|Confirmation' component={Confirmation} />

<Title>
    Confirmation ({name}@{version})
</Title>

```tsx
import { Confirmation } from '@alfalab/core-components-confirmation';
```

## Описание

Компонент подтверждения операции по коду.

<Story name='Песочница'>
    {React.createElement(() => {
        const [value, setValue] = useState({'0': '', '1': '', '2': ''});
        const [codeChecking, setCodeChecking] = useState({'0': false, '1': false, '2': false});
        const [codeSending, setCodeSending] = useState({'0': false, '1': false, '2': false});
        const [error, setError] = useState({'0': '', '1': '', '2': ''});
        const setCode = (index, code) => {
            setValue({...value, [index]: code});
            setError({...error, [index]: ''});
        }
        const handleSubmit = (index) => {
            setCodeChecking({...codeChecking, [index]: true});
            setError({...error, [index]: ''});
            setTimeout(() => {
                setCodeChecking({...codeChecking, [index]: false});
                if (index === '1') {
                    setError({...error, '1': 'Неправильный код'});
                } else if (index === '2') {
                    setError({...error, '2': 'Срок подписания кодом истёк. Пожалуйста, выполните операцию заново'});
                }
            }, 1500);
        }
        const handleSmsRetryClick = (index) => {
            setCodeSending({...codeSending, [index]: true});
            setError({...error, [index]: ''});
            setCode(index, '')
            setTimeout(() => {
                setCodeSending({...codeSending, [index]: false});
            }, 1500);
        }
        return (
            <div style={{display: 'flex'}}>
                <div style={{display: 'flex', width: '100%', maxWidth: '375px', padding: '15px', boxSizing: 'border-box'}}>
                    <Confirmation
                        signTitle="Введите код из смс (успешный кейс)"
                        phone='+7 000 000 00 42'
                        onInputFinished={() => handleSubmit('0')}
                        onSmsRetryClick={() => handleSmsRetryClick('0')}
                        codeSending={codeSending['0']}
                        codeChecking={codeChecking['0']}
                        countdownDuration={10000}
                        value={value['0']}
                        error={''}
                        onInputChange={(code) => setCode('0', code)}
                        alignContent={select('alignContent', ['center', 'left'], 'left')}
                    />
                </div>
                <div style={{display: 'flex', width: '100%', maxWidth: '375px', padding: '15px', boxSizing: 'border-box'}}>
                    <Confirmation
                        signTitle="Введите код из смс (кейс с ошибкой)"
                        phone='+7 000 000 00 42'
                        onInputFinished={() => handleSubmit('1')}
                        onSmsRetryClick={() => handleSmsRetryClick('1')}
                        codeSending={codeSending['1']}
                        codeChecking={codeChecking['1']}
                        error={error['1']}
                        countdownDuration={10000}
                        value={value['1']}
                        onInputChange={(code) => setCode('1', code)}
                        alignContent={select('alignContent', ['center', 'left'], 'left')}
                    />
                </div>
                <div style={{display: 'flex', width: '100%', maxWidth: '375px', padding: '15px', boxSizing: 'border-box'}}>
                    <Confirmation
                        signTitle="Введите код из смс (кейс с критичной ошибкой)"
                        phone='+7 000 000 00 42'
                        onInputFinished={() => handleSubmit('2')}
                        onSmsRetryClick={() => handleSmsRetryClick('2')}
                        codeSending={codeSending['2']}
                        codeChecking={codeChecking['2']}
                        error={error['2']}
                        errorIsFatal={true}
                        countdownDuration={10000}
                        value={value['2']}
                        onInputChange={(code) => setCode('2', code)}
                        alignContent={select('alignContent', ['center', 'left'], 'left')}
                    />
                </div>
            </div>
        );
    })}
</Story>

<Props of={Confirmation} />
